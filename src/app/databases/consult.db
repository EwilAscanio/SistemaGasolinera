CREATE DATABASE `db_gasolinera`

use db_gasolinera

CREATE TABLE `users` (
  `id_usr` integer PRIMARY KEY AUTO_INCREMENT,
  `name_usr` varchar(100) NOT NULL,
  `login_usr` varchar(100) NOT NULL,
  `email_usr` varchar(50) NOT NULL,
  `password_usr` varchar(200) NOT NULL,
  `id_rol` integer NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE `roles` (
  `id_rol` integer PRIMARY KEY AUTO_INCREMENT,
  `name_rol` VARCHAR(50) DEFAULT 'Usuario',
);

ALTER TABLE users
ADD CONSTRAINT `FK_UsersRoles`
FOREIGN KEY (`id_rol`) REFERENCES roles(`id_rol`);

INSERT INTO roles(name_rol) VALUES('Administrador');
INSERT INTO roles(name_rol) VALUES('Usuario');

INSERT INTO users(name_usr, login_usr, email_usr, password_usr, id_rol) VALUES('Admin', 'admin', 'admin@gmail.com', '$2b$05$LP1H7j8wtHnMLq7Cl5dq7.2VSuHcvfdxvbBi1e9J5jpzRKyHgXvHe', 1);

CREATE TABLE `cars` (
  `placa_car` varchar(20) PRIMARY KEY unique,
  `marca_car` varchar(50) NOT NULL,
  `modelo_car` varchar(50) NOT NULL,
  `serial_car` varchar(50) NOT NULL,
  `color_car` varchar(50) NOT NULL,
  `maxlitros_car` decimal NOT NULL,
  `id_tip` integer NOT NULL,
  `id_uso` integer NOT NULL,
  `cedula_pro` integer NOT NULL,
  `codigo_car` VARCHAR(50) DEFAULT 0
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE `tipocars` (
  `id_tip` integer PRIMARY KEY AUTO_INCREMENT,
  `name_tip` VARCHAR(50) DEFAULT 'Usuario',
);

INSERT INTO tipocars(name_tip) VALUES('Sedan')
INSERT INTO tipocars(name_tip) VALUES('Camioneta')
INSERT INTO tipocars(name_tip) VALUES('Camion')
INSERT INTO tipocars(name_tip) VALUES('Gandola')

ALTER TABLE cars
ADD CONSTRAINT `FK_CarsTipoCars`
FOREIGN KEY (`id_tip`) REFERENCES tipocars(`id_tip`);

CREATE TABLE `propietario` (
  `cedula_pro` integer PRIMARY KEY unique,
  `name_pro` varchar(50) NOT NULL,
  `apellido_pro` varchar(50) NOT NULL,
  `direccion_pro` varchar(50) NOT NULL,
  `telefono_pro` varchar(50) NOT NULL,
  `email_pro` varchar(50) NOT NULL,
  `placa_car` varchar(20) DEFAULT 0,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE cars
ADD CONSTRAINT `FK_CarsPropietario`
FOREIGN KEY (`cedula_pro`) REFERENCES propietario(`cedula_pro`);

Notas:

- Crear tabla de Uso Vehiculos
- Crear sus relaciones
- Agregar datos a la tabla de Uso Vehiculos
- Agregar la columna de codigo vehiculo

CREATE TABLE `usoCars` (
  `id_uso` integer PRIMARY KEY AUTO_INCREMENT,
  `name_uso` VARCHAR(50) DEFAULT 'Particular',
);

ALTER TABLE cars
ADD CONSTRAINT `FK_CarsUsoCars`
FOREIGN KEY (`id_uso`) REFERENCES usoCars(`id_uso`);

INSERT INTO usoCars(name_uso) VALUES('Particular')
INSERT INTO usoCars(name_uso) VALUES('Gubernamental')
INSERT INTO usoCars(name_uso) VALUES('Empresarial')
INSERT INTO usoCars(name_uso) VALUES('Otro')


ALTER TABLE cars
ADD COLUMN `codigo_car` VARCHAR(50) DEFAULT 0;

modificaion hasta 17-12

Estructura Inner Join para crear una lista de vehiculos con los datos del propietario

SELECT * FROM cars INNER JOIN propietario ON cars.cedula_pro = propietario.cedula_pro;

SELECT * FROM cars INNER JOIN propietario ON cars.cedula_pro = propietario.cedula_pro where propietario.cedula_pro='16501654'

CREATE TABLE `estacionservicio` (
  `id_estacion` integer PRIMARY KEY AUTO_INCREMENT,
  `nombreestacion` VARCHAR(70),
);



CREATE TABLE `ventascombustible` (
  `id_ticket` integer PRIMARY KEY AUTO_INCREMENT,
  `id_estacion` integer NOT null,
  `cedula_pro` integer NOT NULL,
  `placa_car` varchar(20) NOT NULL,
  `litrosdespachados` integer NOT NULL,
  `id_uso` integer NOT NULL,
  `fechadespacho` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, '45Y78', 40, 2);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'AAB-213', 40, 1);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'AAB-214', 40, 2);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'AAB-215', 40, 3);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'CFJ-32P', 40, 4);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'DDD-331', 40, 5);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'DDD-332', 20, 1);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'DDD-333', 40, 2);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'EFJ-32E', 20, 3);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'EFJ-32P', 40, 4);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'EFJ-32Q', 40, 1);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'EFJ-32R', 20, 2);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'EFJ-32V', 40, 5);
INSERT INTO ventascombustible(id_estacion, cedula_pro, placa_car, litrosdespachados, id_uso) VALUES(1, 16501654, 'EFJ-32Y', 40, 1);
INSERT INTO estacionservicio(nombreestacion) VALUES('Estacion 2');

Agregar a la tabla ventascombustible una columna `id_uso` integer PRIMARY KEY AUTO_INCREMENT,
esto se realiza para relacionar la tabla usoCars con ventascombustible

ALTER TABLE ventascombustible
ADD COLUMN `id_uso` integer AFTER `litrosdespachados`;

Relacion de la tabla
ALTER TABLE ventascombustible
ADD CONSTRAINT `FK_VentaUsoCars`
FOREIGN KEY (`id_uso`) REFERENCES usoCars(`id_uso`);